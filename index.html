<script>
  const coordsBox = document.getElementById("coordsBox");
  const model = document.getElementById("model3d");

  let modelReady = false;

  // =====================
  // Confirmar carga del modelo
  // =====================
  model.addEventListener("model-loaded", () => {
    modelReady = true;
    console.log("✅ Modelo GLB cargado correctamente");
    coordsBox.textContent = "Modelo cargado. Mueve tu mano ✋";
  });

  // =====================
  // MediaPipe Hands
  // =====================
  const hands = new Hands({
    locateFile: file =>
      `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`
  });

  hands.setOptions({
    maxNumHands: 1,
    modelComplexity: 1,
    minDetectionConfidence: 0.7,
    minTrackingConfidence: 0.7
  });

  hands.onResults(results => {
    if (!modelReady) return;

    if (!results.multiHandLandmarks || results.multiHandLandmarks.length === 0) {
      coordsBox.textContent = "No se detecta mano…";
      return;
    }

    const indexTip = results.multiHandLandmarks[0][8];

    // Convertir X (0–1) a grados
    const rotY = (indexTip.x - 0.5) * 180;

    model.setAttribute("rotation", `0 ${rotY} 0`);
    coordsBox.textContent = `Rotación eje Y: ${rotY.toFixed(1)}°`;
  });

  // =====================
  // Cámara oculta
  // =====================
  const video = document.createElement("video");
  video.style.display = "none";
  document.body.appendChild(video);

  const camera = new Camera(video, {
    onFrame: async () => {
      await hands.send({ image: video });
    },
    width: 640,
    height: 480
  });

  camera.start();
</script>
