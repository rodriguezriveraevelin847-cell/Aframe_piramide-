<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Pirámide con MediaPipe</title>

  <!-- A-FRAME -->
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>

  <!-- MEDIAPIPE -->
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>

  <style>
    body { margin: 0; background: #111; }
    #info {
      position: absolute;
      top: 10px;
      left: 10px;
      color: #00ff00;
      font-family: monospace;
      background: rgba(0,0,0,0.6);
      padding: 8px;
      border-radius: 6px;
      z-index: 10;
    }
  </style>
</head>

<body>

<div id="info">Esperando mano…</div>

<a-scene background="color: #111">

  <!-- MODELO -->
  <a-assets>
    <a-asset-item id="piramide" src="piramide.glb"></a-asset-item>
  </a-assets>

  <!-- LUCES -->
  <a-entity light="type: ambient; intensity: 1.6"></a-entity>
  <a-entity light="type: directional; intensity: 1"
            position="1 2 1"></a-entity>

  <!-- PIRÁMIDE -->
  <a-entity
    id="model3d"
    gltf-model="#piramide"
    position="0 0.5 -2"
    scale="1 1 1">
  </a-entity>

  <a-camera position="0 1.6 0"></a-camera>
</a-scene>

<script>
const model = document.getElementById("model3d");
const info = document.getElementById("info");

const hands = new Hands({
  locateFile: file =>
    `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`
});

hands.setOptions({
  maxNumHands: 1,
  modelComplexity: 1,
  minDetectionConfidence: 0.7,
  minTrackingConfidence: 0.7
});

hands.onResults(results => {
  if (!results.multiHandLandmarks) {
    info.textContent = "No se detecta mano";
    return;
  }

  const index = results.multiHandLandmarks[0][8];

  const rotY = (index.x - 0.5) * 180;
  const rotX = (index.y - 0.5) * -180;

  model.setAttribute(
    "rotation",
    `${rotX.toFixed(1)} ${rotY.toFixed(1)} 0`
  );

  info.textContent =
    `Rot X: ${rotX.toFixed(1)} | Rot Y: ${rotY.toFixed(1)}`;
});

const video = document.createElement("video");
video.style.display = "none";
document.body.appendChild(video);

const camera = new Camera(video, {
  onFrame: async () => {
    await hands.send({ image: video });
  },
  width: 640,
  height: 480
});

camera.start();
</script>

</body>
</html>
